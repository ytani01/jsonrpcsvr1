# RPCメソッドの動的登録への改造タスク

# メソッド登録の動的化タスクリスト

## 目的
`src/jsonrpcsvr1/json_api.py` における RPC メソッドの登録を、手動の `METHOD_LIST` ではなく、`src/jsonrpcsvr1/funcs/` ディレクトリ内のモジュールから動的に検出・登録するように変更する。

## タスク

- [x] **1. `src/jsonrpcsvr1/funcs/` 内のモジュールを特定する**
    - `src/jsonrpcsvr1/funcs/` ディレクトリ内のすべての Python モジュール（例: `calc.py`, `echo.py`）をプログラム的に検出する方法を検討する。

- [x] **2. モジュールを動的にインポートする**
    - 特定した各モジュールをランタイムでインポートするメカニズムを実装する。
        - `os.listdir()` や `glob.glob()` を使用して、`src/jsonrpcsvr1/funcs/` ディレクトリ内の `.py` ファイルを列挙する。
        - 各 `.py` ファイル名から拡張子を除去し、モジュール名（例: `calc`, `echo`）を生成する。
        - `importlib.import_module()` を使用して、生成したモジュール名に基づいて各モジュールを動的にインポートする。

- [x] **3. 各モジュール内の RPC メソッドを識別する**
    - RPC メソッドとして公開すべき関数を識別するための基準を定義する（例: `async` 関数であること、特定のプレフィックス（`rpc_` など）を持つこと、カスタムデコレータが付与されていること）。
    - 現時点では、`funcs` モジュール内のすべての `async` 関数を RPC メソッドと仮定する。

- [x] **4. 識別されたメソッドを収集する**
    - 各モジュールから識別されたすべての RPC メソッドをリストとして収集する。

- [x] **5. `json_api.py` 内の `METHOD_LIST` を置き換える**
    - 収集した動的なメソッドリストを使用して、`src/jsonrpcsvr1/json_api.py` 内のハードコードされた `METHOD_LIST` を置き換える。

- [x] **6. 不要なインポートを削除する**
    - 動的登録が実装された後、`src/jsonrpcsvr1/json_api.py` から `jsonrpcsvr1.funcs.calc` および `jsonrpcsvr1/funcs.echo` からの明示的な関数インポートを削除する。