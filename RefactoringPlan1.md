# リファクタリング計画

`src/` 以下のコードを精読した結果、以下のリファクタリングの機会が特定されました。

## (**却下**) 1. ロガー初期化の一元化

### 現状
`src/jsonrpcsvr1/__main__.py`、`src/jsonrpcsvr1/json_api.py`、および `src/jsonrpcsvr1/funcs/calc.py` の各ファイル内で、ロガーの初期化 (`__log = get_logger_from_env(ENV_DEBUG, __name__)`) がモジュールレベルおよび関数内で複数回行われています。

### 改善案
ロガーの初期化を各モジュールのトップレベルに移動し、関数内での重複した初期化を避けることで、コードの重複を減らし、ロガーインスタンスの管理を簡素化します。

## (**却下**) 2. `add_each` 関数 (`src/jsonrpcsvr1/funcs/calc.py`) のエラーハンドリングの改善

### 現状
`add_each` 関数では、広範な `Exception` をキャッチしており、エラー発生時に文字列を返しています。これは、関数の型ヒント (`list[int]`) と矛盾し、JSON-RPC のエラー処理メカニズムとの整合性が低い可能性があります。

### 改善案

-   より具体的な例外 (`IndexError` など) をキャッチするように変更します。
-   エラー発生時には文字列を返す代わりに、`ValueError` などの標準的な Python 例外を発生させるようにします。これにより、JSON-RPC フレームワークがエラーをより適切に処理できるようになり、一貫性のあるエラー応答を提供できます。

## (**完了**) 3. メソッド登録の動的化 (`src/jsonrpcsvr1/json_api.py`)

### 現状
`METHOD_LIST` が手動で管理されており、新しい RPC メソッドが追加されるたびにこのリストを更新する必要があります。メソッドの数が増えると、この管理は煩雑になる可能性があります。

### 改善案
`src/jsonrpcsvr1/funcs/` ディレクトリ内のモジュールを動的に探索し、RPC メソッドとして公開すべき関数を自動的に登録するように変更します。例えば、特定の命名規則 (`rpc_` で始まる関数名) やデコレータを持つ関数を自動的に検出して登録するメカニズムを導入します。これにより、新しいメソッドの追加が容易になり、`METHOD_LIST` の手動管理が不要になります。
